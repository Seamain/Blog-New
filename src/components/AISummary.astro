---
import { generateAISummary } from "../api/AiSummary";

interface Props {
    content: string;
    title: string;
}

const { content, title } = Astro.props;

let summary = "";
let error = false;

try {
    summary = await generateAISummary(content, title);
} catch (e) {
    console.error("Failed to generate AI summary:", e);
    error = true;
}
---

<div
    class="ai-summary-container w-full max-w-4xl not-sm:max-w-xs md:max-w-4xl mt-6 mb-6"
>
    <div
        class="bg-linear-to-r from-blue-50 to-purple-50 dark:from-slate-800 dark:to-slate-700 rounded-lg p-6 border-l-4 border-blue-500 shadow-md"
    >
        <div class="flex items-center mb-3">
            <svg
                class="w-6 h-6 mr-2 text-blue-600 dark:text-blue-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                ></path>
            </svg>
            <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100">
                智能总结
            </h3>
        </div>

        {
            !error && summary && (
                <div class="text-gray-700 dark:text-gray-300 leading-relaxed">
                    <p class="text-base">{summary}</p>
                </div>
            )
        }

        {
            error && (
                <div class="text-red-600 dark:text-red-400 text-sm">
                    <p>生成摘要失败，请稍后重试</p>
                </div>
            )
        }

        {
            !error && !summary && (
                <div class="flex items-center justify-center py-4">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500" />
                    <span class="ml-3 text-sm text-gray-500">
                        正在生成摘要...
                    </span>
                </div>
            )
        }
    </div>
</div>

<style>
    .ai-summary-container {
        animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
