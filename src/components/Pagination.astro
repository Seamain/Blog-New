---
export interface Props {
  outerDiv?: string;
  buttonGroup?: string;
  button?: string;
  activeButton?: string;
  disabledButton?: string;
  currentPage: number;
  totalPage: number;
  url: string;
}

const {
  outerDiv = "flex w-full justify-center",
  buttonGroup = "inline-flex items-center gap-2 rounded-full border border-slate-200/70 bg-white/85 px-2 py-1 shadow-sm shadow-slate-200/40 dark:border-slate-800/70 dark:bg-slate-900/80 dark:shadow-slate-950/40",
  button = "relative inline-flex items-center justify-center rounded-full px-4 py-2 text-sm font-semibold text-slate-600 transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-300 hover:bg-blue-50 hover:text-slate-900 dark:text-slate-300 dark:focus-visible:outline-blue-700 dark:hover:bg-blue-950/30",
  activeButton = "bg-blue-600 text-white shadow-inner hover:bg-blue-700 dark:bg-blue-500 dark:text-white dark:hover:bg-blue-400",
  disabledButton = "pointer-events-none opacity-40",
  currentPage,
  totalPage,
  url,
} = Astro.props as Props;

const current = Number(currentPage);
const total = Number(totalPage);

const buildHref = (page: number) => `/${url}/${page === 1 ? "" : page}`;
const prevPage = current > 1 ? current - 1 : null;
const nextPage = current < total ? current + 1 : null;

let pageStatuses = Array.from({ length: total }, (_, i) => i + 1).map((i) => {
  return {
    pageNumber: i,
    isActive: current === i,
    isDisabled: isDisabled(i),
  };
});

function isDisabled(i: number) {
  if (total <= 6) return false;
  if (i <= 2 || i >= total - 1) return false;
  if (current === i - 1 || current === i || current === i + 1) return false;
  return true;
}
---

<nav class={outerDiv} aria-label="Pagination">
  <div class={buttonGroup}>
    {
      prevPage ? (
        <a class={button} href={buildHref(prevPage)} aria-label="Previous page">
          Prev
        </a>
      ) : (
        <span class={`${button} ${disabledButton}`} aria-disabled="true">
          Prev
        </span>
      )
    }

    {
      pageStatuses.map((pageStatus, index) =>
        pageStatus.isActive ? (
          <span class={`${button} ${activeButton}`} aria-current="page">
            {pageStatus.pageNumber}
          </span>
        ) : pageStatus.isDisabled ? (
          !pageStatuses[index - 1]?.isDisabled && (
            <span class={`${button} ${disabledButton}`} aria-hidden="true">
              ...
            </span>
          )
        ) : (
          <a class={button} href={buildHref(pageStatus.pageNumber)}>
            {pageStatus.pageNumber}
          </a>
        ),
      )
    }

    {
      nextPage ? (
        <a class={button} href={buildHref(nextPage)} aria-label="Next page">
          Next
        </a>
      ) : (
        <span class={`${button} ${disabledButton}`} aria-disabled="true">
          Next
        </span>
      )
    }
  </div>
</nav>
