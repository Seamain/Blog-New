---
import BasicStyle from "../layouts/BasicStyle.astro";
import PostCard from "../components/PostCard.astro";
import { listPosts } from "../api/Post";
import unwrap from "../libs/unwrap";
import type Post from "../interfaces/Post";
import Navbar from "../components/Navbar.astro";

let posts: Post[] = [];
try {
  posts = unwrap((await listPosts()).data).map((post) => post);
} catch (error) {
  console.error("Failed to load posts:", error instanceof Error ? error.message : String(error));
  posts = []; // Fallback to empty posts
}
---

<BasicStyle title="Seamain's Blog" description="This is my home page.">
  <div class="relative w-full">
    <div
      class="pointer-events-none absolute -top-28 left-1/2 h-72 w-[36rem] -translate-x-1/2 rounded-full bg-blue-200/40 blur-3xl dark:bg-blue-900/30"
      aria-hidden="true"
    ></div>
    <div
      class="pointer-events-none absolute -bottom-28 right-[-6rem] h-64 w-64 rounded-full bg-sky-200/40 blur-3xl dark:bg-sky-900/30"
      aria-hidden="true"
    ></div>
    <Navbar />
    <main class="mx-auto w-full max-w-6xl px-6 pb-20">
      <section class="relative mt-10 overflow-hidden rounded-3xl border border-slate-200/70 bg-white/80 px-8 py-10 shadow-sm backdrop-blur dark:border-slate-800/70 dark:bg-slate-900/70">
        <div
          class="absolute right-6 top-6 hidden h-20 w-20 rounded-full border border-blue-200/70 bg-blue-50/60 md:block dark:border-blue-900/50 dark:bg-blue-950/40"
          aria-hidden="true"
        ></div>
        <p class="text-xs font-semibold uppercase tracking-[0.35em] text-blue-700/80 dark:text-blue-300/80">
          Field Notes
        </p>
        <h1 class="mt-4 text-4xl font-display tracking-tight text-slate-900 dark:text-slate-50 md:text-5xl">
          欢迎来到 Seamain 的博客
        </h1>
        <p class="mt-4 max-w-2xl text-base text-slate-600 dark:text-slate-400">
          记录技术、产品与生活里的灵感和观察，分享我在创作与构建过程中的思考。
        </p>
        <div class="mt-6 flex flex-wrap gap-2">
          <span class="rounded-full bg-blue-50 px-4 py-2 text-xs font-semibold uppercase tracking-[0.25em] text-blue-700 dark:bg-blue-950/40 dark:text-blue-200">
            Tech
          </span>
          <span class="rounded-full bg-blue-50 px-4 py-2 text-xs font-semibold uppercase tracking-[0.25em] text-blue-700 dark:bg-blue-950/40 dark:text-blue-200">
            Product
          </span>
          <span class="rounded-full bg-blue-50 px-4 py-2 text-xs font-semibold uppercase tracking-[0.25em] text-blue-700 dark:bg-blue-950/40 dark:text-blue-200">
            Life
          </span>
        </div>
        <div class="mt-8 flex flex-wrap gap-3">
          <a
            href="/posts"
            class="inline-flex items-center justify-center rounded-full bg-blue-600 px-5 py-2 text-sm font-semibold text-white transition hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-400"
          >
            浏览文章
          </a>
          <a
            href="/about"
            class="inline-flex items-center justify-center rounded-full border border-blue-200 px-5 py-2 text-sm font-semibold text-slate-700 transition hover:border-blue-300 hover:text-blue-700 dark:border-slate-700 dark:text-slate-200 dark:hover:border-blue-500"
          >
            关于我
          </a>
        </div>
      </section>

      <section class="mt-12">
        <div class="flex items-end justify-between gap-6">
          <div>
            <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500 dark:text-slate-400">
              Latest
            </p>
            <h2 class="mt-2 text-2xl font-display text-slate-900 dark:text-slate-100">
              最新文章
            </h2>
          </div>
          <div class="text-sm text-slate-500 dark:text-slate-400">
            共 {posts.length} 篇
          </div>
        </div>

        {posts.length > 0 ? (
          <>
            <div class="mt-6">
              <PostCard post={posts[0]} ml="max-h-72" />
            </div>
            <div class="mt-6 grid gap-6 md:grid-cols-2">
              {posts.slice(1, 5).map((post) => <PostCard ml="max-h-52" post={post} />)}
            </div>
          </>
        ) : (
          <div class="mt-6 rounded-2xl border border-dashed border-slate-300/80 bg-white/60 px-6 py-10 text-center text-sm text-slate-500 dark:border-slate-700/80 dark:bg-slate-900/50 dark:text-slate-400">
            暂无文章，稍后再来看看。
          </div>
        )}
      </section>
    </main>
  </div>
</BasicStyle>
